<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Health-GPS: Maintainer Guidelines and Policies</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Health-GPS
   &#160;<span id="projectnumber">1.2.2.0</span>
   </div>
   <div id="projectbrief">Global Health Policy Simulation model (Health-GPS)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_maintainer_guide.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Maintainer Guidelines and Policies </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document lists a set of policies that you should apply when adding or updating a port recipe. It is intended to serve the role of <a href="https://www.debian.org/doc/debian-policy/">Debian's Policy Manual</a>, <a href="https://docs.brew.sh/Maintainer-Guidelines">Homebrew's Maintainer Guidelines</a>, and <a href="https://docs.brew.sh/Formula-Cookbook">Homebrew's Formula Cookbook</a>.</p>
<h1><a class="anchor" id="autotoc_md3085"></a>
PR Structure</h1>
<h2><a class="anchor" id="autotoc_md3086"></a>
Make separate Pull Requests per port</h2>
<p>Whenever possible, separate changes into multiple PRs. This makes them significantly easier to review and prevents issues with one set of changes from holding up every other change.</p>
<h2><a class="anchor" id="autotoc_md3087"></a>
Avoid trivial changes in untouched files</h2>
<p>For example, avoid reformatting or renaming variables in portfiles that otherwise have no reason to be modified for the issue at hand. However, if you need to modify the file for the primary purpose of the PR (updating the library), then obviously beneficial changes like fixing typos are appreciated!</p>
<h2><a class="anchor" id="autotoc_md3088"></a>
Check names against other repositories</h2>
<p>A good service to check many at once is <a href="https://repology.org/">Repology</a>. If the library you are adding could be confused with another one, consider renaming to make it clear. We prefer when names are longer and/or unlikely to conflict with any future use of the same name. If the port refers to a library on GitHub, a good practice is to prefix the name with the organization if there is any chance of confusion.</p>
<h2><a class="anchor" id="autotoc_md3089"></a>
Use GitHub Draft PRs</h2>
<p>GitHub Draft PRs are a great way to get CI or human feedback on work that isn't yet ready to merge. Most new PRs should be opened as drafts and converted to normal PRs once the CI passes.</p>
<p>More information about GitHub Draft PRs: <a href="https://github.blog/2019-02-14-introducing-draft-pull-requests/">https://github.blog/2019-02-14-introducing-draft-pull-requests/</a></p>
<h1><a class="anchor" id="autotoc_md3090"></a>
Portfiles</h1>
<h2><a class="anchor" id="autotoc_md3091"></a>
Avoid deprecated helper functions</h2>
<p>At this time, the following helpers are deprecated:</p>
<ul>
<li><a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_vcpkg_extract_source_archive_ex.html">`vcpkg_extract_source_archive_ex()`</a> should be replaced by the supported overload of [<code>vcpkg_extract_source_archive()</code>] (with <code>ARCHIVE</code>)</li>
<li>The deprecated overload of <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_vcpkg_extract_source_archive.html">`vcpkg_extract_source_archive()`</a> without <code>ARCHIVE</code> should be replaced by the supported overload with <code>ARCHIVE</code>.</li>
<li><code>vcpkg_apply_patches()</code> should be replaced by the <code>PATCHES</code> arguments to the "extract" helpers (e.g. <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_vcpkg_from_github.html">`vcpkg_from_github()`</a>)</li>
<li><code>vcpkg_build_msbuild()</code> should be replaced by <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_vcpkg_install_msbuild.html">`vcpkg_install_msbuild()`</a></li>
<li><code>vcpkg_copy_tool_dependencies()</code> should be replaced by <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_vcpkg_copy_tools.html">`vcpkg_copy_tools()`</a></li>
<li><code>vcpkg_configure_cmake</code> should be replaced by <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_vcpkg_cmake_configure.html">`vcpkg_cmake_configure()`</a> after removing <code>PREFER_NINJA</code> (from port <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_ports_vcpkg_cmake.html">`vcpkg-cmake`</a>)</li>
<li><code>vcpkg_build_cmake</code> should be replaced by <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_vcpkg_cmake_build.html">`vcpkg_cmake_build()`</a> (from port <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_ports_vcpkg_cmake.html">`vcpkg-cmake`</a>)</li>
<li><code>vcpkg_install_cmake</code> should be replaced by <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_vcpkg_cmake_install.html">`vcpkg_cmake_install()`</a> (from port <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_ports_vcpkg_cmake.html">`vcpkg-cmake`</a>)</li>
<li><code>vcpkg_fixup_cmake_targets</code> should be replaced by <a href="ports/vcpkg-cmake-config/vcpkg_cmake_config_fixup.md#vcpkg_cmake_config_fixup"><code>vcpkg_cmake_config_fixup</code></a> (from port <a href="ports/vcpkg-cmake-config.md#vcpkg-cmake-config"><code>vcpkg-cmake-config</code></a>)</li>
</ul>
<p>Some of the replacement helper functions are in "tools ports" to allow consumers to pin their behavior at specific versions, to allow locking the behavior of the helpers at a particular version. Tools ports need to be added to your port's <code>"dependencies"</code>, like so:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;vcpkg-cmake&quot;,</div>
<div class="line">  &quot;host&quot;: true</div>
<div class="line">},</div>
<div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;vcpkg-cmake-config&quot;,</div>
<div class="line">  &quot;host&quot;: true</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3092"></a>
Avoid excessive comments in portfiles</h2>
<p>Ideally, portfiles should be short, simple, and as declarative as possible. Remove any boiler plate comments introduced by the <code>create</code> command before submitting a PR.</p>
<h2><a class="anchor" id="autotoc_md3093"></a>
Ports must not be path dependent</h2>
<p>Ports must not change their behavior based on which ports are already installed in a form that would change which contents that port installs. For example, given:</p>
<div class="fragment"><div class="line">&gt; vcpkg install a</div>
<div class="line">&gt; vcpkg install b</div>
<div class="line">&gt; vcpkg remove a</div>
</div><!-- fragment --><p>and</p>
<div class="fragment"><div class="line">&gt; vcpkg install b</div>
</div><!-- fragment --><p>the files installed by <code>b</code> must be the same, regardless of influence by the previous installation of <code>a</code>. This means that ports must not try to detect whether something is provided in the installed tree by another port before taking some action. A specific and common cause of such "path dependent" behavior is described below in "When defining features, explicitly control dependencies."</p>
<h2><a class="anchor" id="autotoc_md3094"></a>
Unique port attribution rule</h2>
<p>In the entire vcpkg system, no two ports a user is expected to use concurrently may provide the same file. If a port tries to install a file already provided by another file, installation will fail. If a port wants to use an extremely common name for a header, for example, it should place those headers in a subdirectory rather than in <code>include</code>.</p>
<h2><a class="anchor" id="autotoc_md3095"></a>
Add CMake exports in an unofficial- namespace</h2>
<p>A core design ideal of vcpkg is to not create "lock-in" for customers. In the build system, there should be no difference between depending on a library from the system, and depending on a library from vcpkg. To that end, we avoid adding CMake exports or targets to existing libraries with "the obvious name", to allow upstreams to add their own official CMake exports without conflicting with vcpkg.</p>
<p>To that end, any CMake configs that the port exports, which are not in the upstream library, should have <code>unofficial-</code> as a prefix. Any additional targets should be in the <code>unofficial::&lt;port&gt;::</code> namespace.</p>
<p>This means that the user should see:</p><ul>
<li><code>find_package(unofficial-&lt;port&gt; CONFIG)</code> as the way to get at the unique-to-vcpkg package</li>
<li><code>unofficial::&lt;port&gt;::&lt;target&gt;</code> as an exported target from that port.</li>
</ul>
<p>Examples:</p><ul>
<li><a href="https://github.com/microsoft/vcpkg/blob/4f0a640e4c5b74166b759a862d7527c930eff32e/ports/brotli/install.patch"><code>brotli</code></a> creates the <code>unofficial-brotli</code> package, producing target <code>unofficial::brotli::brotli</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md3096"></a>
Install copyright file</h2>
<p>Each port has to provide a file named <code>copyright</code> in the folder <code>${CURRENT_PACKAGES_DIR}/share/${PORT}</code>.</p>
<p>Many ports are using this code to install a copyright file:</p>
<div class="fragment"><div class="line">file(INSTALL &quot;${SOURCE_PATH}LICENSE&quot; DESTINATION &quot;${CURRENT_PACKAGES_DIR}/share/${PORT}&quot; RENAME copyright)</div>
</div><!-- fragment --><p>This is discouraged in favour of <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_vcpkg_install_copyright.html">`vcpkg_install_copyright()`</a>. New ports should use <code>vcpkg_install_copyright()</code> instead. However, it is still valid for existing ports to use something like the code above. You may replace this with <code>vcpkg_install_copyright</code> but you don't have to.</p>
<p><code>vcpkg_install_copyright</code> also includes the functionallity to handle multiple copyright files. See its <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_vcpkg_install_copyright.html">documentation</a> for more info.</p>
<h1><a class="anchor" id="autotoc_md3097"></a>
Features</h1>
<h2><a class="anchor" id="autotoc_md3098"></a>
Do not use features to implement alternatives</h2>
<p>Features must be treated as additive functionality. If port[featureA] installs and port[featureB] installs, then port[featureA,featureB] must install. Moreover, if a second port depends on [featureA] and a third port depends on [featureB], installing both the second and third ports should have their dependencies satisfied.</p>
<p>Libraries in this situation must choose one of the available options as expressed in vcpkg, and users who want a different setting must use overlay ports at this time.</p>
<p>Existing examples we would not accept today retained for backwards compatibility:</p><ul>
<li><code>libgit2</code>, <code>libzip</code>, <code>open62541</code> all have features for selecting a TLS or crypto backend. Note that <code>curl</code> has different crypto backend options but allows selecting between them at runtime, meaning the above tenet is maintained.</li>
<li><code>darknet</code> has <code>opencv2</code>, <code>opencv3</code>, features to control which version of opencv to use for its dependencies.</li>
</ul>
<h2><a class="anchor" id="autotoc_md3099"></a>
A feature may engage preview or beta functionality</h2>
<p>Notwithstanding the above, if there is a preview branch or similar where the preview functionality has a high probability of not disrupting the non-preview functionality (for example, no API removals), a feature is acceptable to model this setting.</p>
<p>Examples:</p><ul>
<li>The Azure SDKs (of the form <code>azure-Xxx</code>) have a <code>public-preview</code> feature.</li>
<li><code>imgui</code> has an <code>experimental-docking</code> feature which engages their preview docking branch which uses a merge commit attached to each of their public numbered releases.</li>
</ul>
<h2><a class="anchor" id="autotoc_md3100"></a>
Default features should enable behaviors, not APIs</h2>
<p>If a consumer is depending directly upon a library, they can list out any desired features easily (<code>library[feature1,feature2]</code>). However, if a consumer <em>does not know</em> they are using a library, they cannot list out those features. If that hidden library is like <code>libarchive</code> where features are adding additional compression algorithms (and thus behaviors) to an existing generic interface, default features offer a way to ensure a reasonably functional transitive library is built even if the final consumer doesn't name it directly.</p>
<p>If the feature adds additional APIs (or executables, or library binaries) and doesn't modify the behavior of existing APIs, it should be left off by default. This is because any consumer which might want to use those APIs can easily require it via their direct reference.</p>
<p>If in doubt, do not mark a feature as default.</p>
<h2><a class="anchor" id="autotoc_md3101"></a>
Do not use features to control alternatives in published interfaces</h2>
<p>If a consumer of a port depends on only the core functionality of that port, with high probability they must not be broken by turning on the feature. This is even more important when the alternative is not directly controlled by the consumer, but by compiler settings like <code>/std:c++17</code> / <code>-std=c++17</code>.</p>
<p>Existing examples we would not accept today retained for backwards compatibility:</p><ul>
<li><code>redis-plus-plus[cxx17]</code> controls a polyfill but does not bake the setting into the installed tree.</li>
<li><code>ace[wchar]</code> changes all APIs to accept <code>const wchar_t*</code> rather than <code>const char*</code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md3102"></a>
A feature may replace polyfills with aliases provided that replacement is baked into the installed tree</h2>
<p>Notwithstanding the above, ports may remove polyfills with a feature, as long as:</p><ol type="1">
<li>Turning on the feature changes the polyfills to aliases of the polyfilled entity</li>
<li>The state of the polyfill is baked into the installed headers, such that ABI mismatch "impossible" runtime errors are unlikely</li>
<li>It is possible for a consumer of the port to write code which works in both modes, for example by using a typedef which is either polyfilled or not</li>
</ol>
<p>Example:</p><ul>
<li><code>abseil[cxx17]</code> changes <code>absl::string_view</code> to a replacement or <code>std::string_view</code>; the patch <a href="https://github.com/microsoft/vcpkg/blob/981e65ce0ac1f6c86e5a5ded7824db8780173c76/ports/abseil/fix-cxx-standard.patch">https://github.com/microsoft/vcpkg/blob/981e65ce0ac1f6c86e5a5ded7824db8780173c76/ports/abseil/fix-cxx-standard.patch</a> implements the baking requirement</li>
</ul>
<h2><a class="anchor" id="autotoc_md3103"></a>
Recommended solutions</h2>
<p>If it's critical to expose the underlying alternatives, we recommend providing messages at build time to instruct the user on how to copy the port into a private overlay: </p><div class="fragment"><div class="line">set(USING_DOG 0)</div>
<div class="line">message(STATUS &quot;This version of LibContosoFrobnicate uses the Kittens backend. To use the Dog backend instead, create an overlay port of this with USING_DOG set to 1 and the `kittens` dependency replaced with `dog`.&quot;)</div>
<div class="line">message(STATUS &quot;This recipe is at ${CMAKE_CURRENT_LIST_DIR}&quot;)</div>
<div class="line">message(STATUS &quot;See the overlay ports documentation at https://github.com/microsoft/vcpkg/blob/master/docs/specifications/ports-overlay.md&quot;)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3104"></a>
Build Techniques</h1>
<h2><a class="anchor" id="autotoc_md3105"></a>
Do not use vendored dependencies</h2>
<p>Do not use embedded copies of libraries. All dependencies should be split out and packaged separately so they can be updated and maintained.</p>
<h2><a class="anchor" id="autotoc_md3106"></a>
Prefer using CMake</h2>
<p>When multiple buildsystems are available, prefer using CMake. Additionally, when appropriate, it can be easier and more maintainable to rewrite alternative buildsystems into CMake using <code>file(GLOB)</code> directives.</p>
<p>Examples: <a href="../../ports/abseil/portfile.cmake">abseil</a></p>
<h2><a class="anchor" id="autotoc_md3107"></a>
Choose either static or shared binaries</h2>
<p>By default, <code>vcpkg_cmake_configure()</code> will pass in the appropriate setting for <code>BUILD_SHARED_LIBS</code>, however for libraries that don't respect that variable, you can switch on <code>VCPKG_LIBRARY_LINKAGE</code>:</p>
<div class="fragment"><div class="line">string(COMPARE EQUAL &quot;${VCPKG_LIBRARY_LINKAGE}&quot; &quot;static&quot; KEYSTONE_BUILD_STATIC)</div>
<div class="line">string(COMPARE EQUAL &quot;${VCPKG_LIBRARY_LINKAGE}&quot; &quot;dynamic&quot; KEYSTONE_BUILD_SHARED)</div>
<div class="line"> </div>
<div class="line">vcpkg_cmake_configure(</div>
<div class="line">    SOURCE_PATH ${SOURCE_PATH}</div>
<div class="line">    OPTIONS</div>
<div class="line">        -DKEYSTONE_BUILD_STATIC=${KEYSTONE_BUILD_STATIC}</div>
<div class="line">        -DKEYSTONE_BUILD_SHARED=${KEYSTONE_BUILD_SHARED}</div>
<div class="line">)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3108"></a>
When defining features, explicitly control dependencies</h2>
<p>When defining a feature that captures an optional dependency, ensure that the dependency will not be used accidentally when the feature is not explicitly enabled.</p>
<div class="fragment"><div class="line">set(CMAKE_DISABLE_FIND_PACKAGE_ZLIB ON)</div>
<div class="line">set(CMAKE_REQUIRE_FIND_PACKAGE_ZLIB OFF)</div>
<div class="line">if (&quot;zlib&quot; IN_LIST FEATURES)</div>
<div class="line">  set(CMAKE_DISABLE_FIND_PACKAGE_ZLIB OFF)</div>
<div class="line">  set(CMAKE_REQUIRE_FIND_PACKAGE_ZLIB ON)</div>
<div class="line">endif()</div>
<div class="line"> </div>
<div class="line">vcpkg_cmake_configure(</div>
<div class="line">  SOURCE_PATH ${SOURCE_PATH}</div>
<div class="line">  OPTIONS</div>
<div class="line">    -DCMAKE_DISABLE_FIND_PACKAGE_ZLIB=${CMAKE_DISABLE_FIND_PACKAGE_ZLIB}</div>
<div class="line">    -DCMAKE_REQUIRE_FIND_PACKAGE_ZLIB=${CMAKE_REQUIRE_FIND_PACKAGE_ZLIB}</div>
<div class="line">)</div>
</div><!-- fragment --><p>The snippet below using <code>vcpkg_check_features()</code> is equivalent, <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_vcpkg_check_features.html">see the documentation</a>.</p>
<div class="fragment"><div class="line">vcpkg_check_features(OUT_FEATURE_OPTIONS FEATURE_OPTIONS</div>
<div class="line">  FEATURES</div>
<div class="line">    &quot;zlib&quot;    CMAKE_REQUIRE_FIND_PACKAGE_ZLIB</div>
<div class="line">  INVERTED_FEATURES</div>
<div class="line">    &quot;zlib&quot;    CMAKE_DISABLE_FIND_PACKAGE_ZLIB</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line">vcpkg_cmake_configure(</div>
<div class="line">    SOURCE_PATH ${SOURCE_PATH}</div>
<div class="line">    OPTIONS</div>
<div class="line">      ${FEATURE_OPTIONS}</div>
<div class="line">)</div>
</div><!-- fragment --><p>Note that <code>ZLIB</code> in the above is case-sensitive. See the <a href="https://cmake.org/cmake/help/v3.22/variable/CMAKE_DISABLE_FIND_PACKAGE_PackageName.html">CMAKE_DISABLE_FIND_PACKAGE_PackageName</a> and <a href="https://cmake.org/cmake/help/v3.22/variable/CMAKE_REQUIRE_FIND_PACKAGE_PackageName.html">CMAKE_REQUIRE_FIND_PACKAGE_PackageName</a> documnetation for more details.</p>
<h2><a class="anchor" id="autotoc_md3109"></a>
Place conflicting libs in a &lt;tt&gt;manual-link&lt;/tt&gt; directory</h2>
<p>A lib is considered conflicting if it does any of the following:</p><ul>
<li>Define <code>main</code></li>
<li>Define malloc</li>
<li>Define symbols that are also declared in other libraries</li>
</ul>
<p>Conflicting libs are typically by design and not considered a defect. Because some build systems link against everything in the lib directory, these should be moved into a subdirectory named <code>manual-link</code>.</p>
<h1><a class="anchor" id="autotoc_md3110"></a>
Manifests and CONTROL files</h1>
<p>When adding a new port, use the new manifest syntax for defining a port; you may also change over to manifests when modifying an existing port. You may do so easily by running the <code>vcpkg format-manifest</code> command, which will convert existing CONTROL files into manifest files. Do not convert CONTROL files that have not been modified.</p>
<h1><a class="anchor" id="autotoc_md3111"></a>
Versioning</h1>
<h2><a class="anchor" id="autotoc_md3112"></a>
Follow common conventions for the &lt;tt&gt;"version"&lt;/tt&gt; field</h2>
<p>See our <a href="../users/versioning.md#version-schemes">versioning documentation</a> for a full explanation of our conventions.</p>
<h2><a class="anchor" id="autotoc_md3113"></a>
Update the &lt;tt&gt;"port-version"&lt;/tt&gt; field in the manifest file of any modified ports</h2>
<p>Vcpkg uses this field to determine whether a given port is out-of-date and should be changed whenever the port's behavior changes.</p>
<p>Our convention is to use the <code>"port-version"</code> field for changes to the port that don't change the upstream version, and to reset the <code>"port-version"</code> back to zero when an update to the upstream version is made.</p>
<p>For Example:</p>
<ul>
<li>Zlib's package version is currently <code>1.2.1</code>, with no explicit <code>"port-version"</code> (equivalent to a <code>"port-version"</code> of <code>0</code>).</li>
<li>You've discovered that the wrong copyright file has been deployed, and fixed that in the portfile.</li>
<li>You should update the <code>"port-version"</code> field in the manifest file to <code>1</code>.</li>
</ul>
<p>See our <a href="manifest-files.md#port-version">manifest files document</a> for a full explanation of our conventions.</p>
<h2><a class="anchor" id="autotoc_md3114"></a>
Update the version files in &lt;tt&gt;versions/&lt;/tt&gt; of any modified ports</h2>
<p>Vcpkg uses a set of metadata files to power its versioning feature. These files are located in the following locations:</p><ul>
<li><code>${VCPKG_ROOT}/versions/baseline.json</code>, (this file is common to all ports) and</li>
<li><code>${VCPKG_ROOT}/versions/${first-letter-of-portname}-/${portname}.json</code> (one per port).</li>
</ul>
<p>For example, for <code>zlib</code> the relevant files are:</p><ul>
<li><code>${VCPKG_ROOT}/versions/baseline.json</code></li>
<li><code>${VCPKG_ROOT}/versions/z-/zlib.json</code></li>
</ul>
<p>We expect that each time you update a port, you also update its version files.</p>
<p><b>The recommended method to update these files is to run the <code>x-add-version</code> command, e.g.:</b></p>
<div class="fragment"><div class="line">vcpkg x-add-version zlib</div>
</div><!-- fragment --><p>If you're updating multiple ports at the same time, instead you can run:</p>
<div class="fragment"><div class="line">vcpkg x-add-version --all</div>
</div><!-- fragment --><p>To update the files for all modified ports at once.</p>
<p><em>NOTE: These commands require you to have committed your changes to the ports before running them. The reason is that the Git SHA of the port directory is required in these version files. But don't worry, the <code>x-add-version</code> command will warn you if you have local changes that haven't been committed.</em></p>
<p>See our <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_specifications_versioning.html">versioning specification</a> and <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_specifications_registries_2.html">registries specification</a> to learn how vcpkg interacts with these files.</p>
<h1><a class="anchor" id="autotoc_md3115"></a>
Patching</h1>
<h2><a class="anchor" id="autotoc_md3116"></a>
Prefer options over patching</h2>
<p>It is preferable to set options in a call to <code>vcpkg_configure_xyz()</code> over patching the settings directly.</p>
<p>Common options that allow avoiding patching:</p><ol type="1">
<li>[MSBUILD] <code>&lt;PropertyGroup&gt;</code> settings inside the project file can be overridden via <code>/p:</code> parameters</li>
<li>[CMAKE] Calls to <code>find_package(XYz)</code> in CMake scripts can be disabled via <a href="https://cmake.org/cmake/help/v3.15/variable/CMAKE_DISABLE_FIND_PACKAGE_PackageName.html"><code>-DCMAKE_DISABLE_FIND_PACKAGE_XYz=ON</code></a></li>
<li>[CMAKE] Cache variables (declared as <code>set(VAR "value" CACHE STRING "Documentation")</code> or <code>option(VAR "Documentation" "Default Value")</code>) can be overridden by just passing them in on the command line as <code>-DVAR:STRING=<a class="el" href="classFoo.html">Foo</a></code>. One notable exception is if the <code>FORCE</code> parameter is passed to <code>set()</code>. See also the <a href="https://cmake.org/cmake/help/v3.15/command/set.html">CMake <code>set</code> documentation</a></li>
</ol>
<h2><a class="anchor" id="autotoc_md3117"></a>
Prefer patching over overriding &lt;tt&gt;VCPKG_&lt;VARIABLE&gt;&lt;/tt&gt; values</h2>
<p>Some variables prefixed with <code>VCPKG_&lt;VARIABLE&gt;</code> have an equivalent <code>CMAKE_&lt;VARIABLE&gt;</code>. However, not all of them are passed to the internal package build <a href="../../scripts/toolchains/windows.cmake">(see implementation: Windows toolchain)</a>.</p>
<p>Consider the following example:</p>
<div class="fragment"><div class="line">set(VCPKG_C_FLAGS &quot;-O2 ${VCPKG_C_FLAGS}&quot;)</div>
<div class="line">set(VCPKG_CXX_FLAGS &quot;-O2 ${VCPKG_CXX_FLAGS}&quot;)</div>
</div><!-- fragment --><p>Using <code>vcpkg</code>'s built-in toolchains this works, because the value of <code>VCPKG_&lt;LANG&gt;_FLAGS</code> is forwarded to the appropriate <code>CMAKE_LANG_FLAGS</code> variable. But, a custom toolchain that is not aware of <code>vcpkg</code>'s variables will not forward them.</p>
<p>Because of this, it is preferable to patch the buildsystem directly when setting <code>CMAKE_&lt;LANG&gt;_FLAGS</code>.</p>
<h2><a class="anchor" id="autotoc_md3118"></a>
Minimize patches</h2>
<p>When making changes to a library, strive to minimize the final diff. This means you should <em>not</em> reformat the upstream source code when making changes that affect a region. Also, when disabling a conditional, it is better to add a <code>AND FALSE</code> or <code>&amp;&amp; 0</code> to the condition than to delete every line of the conditional.</p>
<p>Don't add patches if the port is outdated and updating the port to a newer released version would solve the same issue. vcpkg prefers updating ports over patching outdated versions unless the version bump breaks a considerable amount of dependent ports.</p>
<p>This helps to keep the size of the vcpkg repository down as well as improves the likelihood that the patch will apply to future code versions.</p>
<h2><a class="anchor" id="autotoc_md3119"></a>
Do not implement features in patches</h2>
<p>The purpose of patching in vcpkg is to enable compatibility with compilers, libraries, and platforms. It is not to implement new features in lieu of following proper Open Source procedure (submitting an Issue/PR/etc).</p>
<h1><a class="anchor" id="autotoc_md3120"></a>
Do not build tests/docs/examples by default</h1>
<p>When submitting a new port, check for any options like <code>BUILD_TESTS</code> or <code>WITH_TESTS</code> or <code>POCO_ENABLE_SAMPLES</code> and ensure the additional binaries are disabled. This minimizes build times and dependencies for the average user.</p>
<p>Optionally, you can add a <code>test</code> feature which enables building the tests, however this should not be in the <code>Default-Features</code> list.</p>
<h1><a class="anchor" id="autotoc_md3121"></a>
Enable existing users of the library to switch to vcpkg</h1>
<h2><a class="anchor" id="autotoc_md3122"></a>
Do not add &lt;tt&gt;CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS&lt;/tt&gt;</h2>
<p>Unless the author of the library is already using it, we should not use this CMake functionality because it interacts poorly with C++ templates and breaks certain compiler features. Libraries that don't provide a .def file and do not use __declspec() declarations simply do not support shared builds for Windows and should be marked as such with <code>vcpkg_check_linkage(ONLY_STATIC_LIBRARY)</code>.</p>
<h2><a class="anchor" id="autotoc_md3123"></a>
Do not rename binaries outside the names given by upstream</h2>
<p>This means that if the upstream library has different names in release and debug (libx versus libxd), then the debug library should not be renamed to <code>libx</code>. Vice versa, if the upstream library has the same name in release and debug, we should not introduce a new name.</p>
<p>Important caveat:</p><ul>
<li>Static and shared variants often should be renamed to a common scheme. This enables consumers to use a common name and be ignorant of the downstream linkage. This is safe because we only make one at a time available.</li>
</ul>
<p>Note that if a library generates CMake integration files (<code>foo-config.cmake</code>), renaming must be done through patching the CMake build itself instead of simply calling <code>file(RENAME)</code> on the output archives/LIBs.</p>
<p>Finally, DLL files on Windows should never be renamed post-build because it breaks the generated LIBs.</p>
<h1><a class="anchor" id="autotoc_md3124"></a>
Code format</h1>
<h2><a class="anchor" id="autotoc_md3125"></a>
Vcpkg internal code</h2>
<p>We require the C++ code inside vcpkg to follow the clang-format, if you change them. Please perform the following steps after modification:</p>
<ul>
<li>Use Visual Studio:</li>
</ul>
<ol type="1">
<li>Configure your <a href="https://devblogs.microsoft.com/cppblog/clangformat-support-in-visual-studio-2017-15-7-preview-1/">clang-format tools</a>.</li>
<li>Open the modified file.</li>
<li>Use shortcut keys Ctrl+K, Ctrl+D to format the current file.</li>
</ol>
<ul>
<li>Use tools:</li>
</ul>
<ol type="1">
<li>Install <a href="https://releases.llvm.org/download.html#10.0.0">llvm clang-format</a></li>
<li>Run command: <div class="fragment"><div class="line">&gt; LLVM_PATH/bin/clang-format.exe -style=file -i changed_file.cpp</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md3126"></a>
Manifests</h2>
<p>We require that the manifest file be formatted. Use the following command to format all manifest files:</p>
<div class="fragment"><div class="line">&gt; vcpkg format-manifest --all</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3127"></a>
Useful implementation notes</h1>
<h2><a class="anchor" id="autotoc_md3128"></a>
Portfiles are run in Script Mode</h2>
<p>While <code>portfile.cmake</code>'s and <code>CMakeLists.txt</code>'s share a common syntax and core CMake language constructs (aka "Scripting Commands"), portfiles run in "Script Mode", whereas <code>CMakeLists.txt</code> files run in "Project Mode". The most important difference between these two modes is that "Script Mode" does not have the concepts of "Toolchain", "Language" and "Target". Any behaviors, including scripting commands, which depend on these constructs (e.g. <code>CMAKE_CXX_COMPILER</code>, <code>CMAKE_EXECUTABLE_SUFFIX</code>, <code>CMAKE_SYSTEM_NAME</code>) will not be correct.</p>
<p>Portfiles have direct access to variables set in the triplet file, but <code>CMakeLists.txt</code>s do not (though there is often a translation that happens &ndash; <code>VCPKG_LIBRARY_LINKAGE</code> versus <code>BUILD_SHARED_LIBS</code>).</p>
<p>Portfiles and Project builds invoked by portfiles are run in different processes. Conceptually:</p>
<div class="fragment"><div class="line">+----------------------------+       +------------------------------------+</div>
<div class="line">| CMake.exe                  |       | CMake.exe                          |</div>
<div class="line">+----------------------------+       +------------------------------------+</div>
<div class="line">| Triplet file               | ====&gt; | Toolchain file                     |</div>
<div class="line">| (x64-windows.cmake)        |       | (scripts/buildsystems/vcpkg.cmake) |</div>
<div class="line">+----------------------------+       +------------------------------------+</div>
<div class="line">| Portfile                   | ====&gt; | CMakeLists.txt                     |</div>
<div class="line">| (ports/foo/portfile.cmake) |       | (buildtrees/../CMakeLists.txt)     |</div>
<div class="line">+----------------------------+       +------------------------------------+</div>
</div><!-- fragment --><p>To determine the host in a portfile, the standard CMake variables are fine (<code>CMAKE_HOST_WIN32</code>).</p>
<p>To determine the target in a portfile, the vcpkg triplet variables should be used (<code>VCPKG_CMAKE_SYSTEM_NAME</code>).</p>
<p>See also our <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_users_triplets.html">triplet documentation</a> for a full enumeration of possible settings. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
