<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Health-GPS: Reducing Variance</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Health-GPS
   &#160;<span id="projectnumber">1.2.2.0</span>
   </div>
   <div id="projectbrief">Global Health Policy Simulation model (Health-GPS)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_runner_work_healthgps_healthgps_vcpkg_packages_benchmark_x64_linux_share_doc_benchmark_reducing_variance.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Reducing Variance </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="disabling-cpu-frequency-scaling"></a></p>
<h1><a class="anchor" id="autotoc_md3889"></a>
Disabling CPU Frequency Scaling</h1>
<p>If you see this error:</p>
<div class="fragment"><div class="line">***WARNING*** CPU scaling is enabled, the benchmark real time measurements may be noisy and will incur extra overhead.</div>
</div><!-- fragment --><p>you might want to disable the CPU frequency scaling while running the benchmark, as well as consider other ways to stabilize the performance of your system while benchmarking.</p>
<p>See <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_packages_benchmark_x64_linux_share_doc_benchmark_reducing_variance.html">Reducing Variance</a> for more information.</p>
<p>Exactly how to do this depends on the Linux distribution, desktop environment, and installed programs. Specific details are a moving target, so we will not attempt to exhaustively document them here.</p>
<p>One simple option is to use the <code>cpupower</code> program to change the performance governor to "performance". This tool is maintained along with the Linux kernel and provided by your distribution.</p>
<p>It must be run as root, like this:</p>
<div class="fragment"><div class="line">sudo cpupower frequency-set --governor performance</div>
</div><!-- fragment --><p>After this you can verify that all CPUs are using the performance governor by running this command:</p>
<div class="fragment"><div class="line">cpupower frequency-info -o proc</div>
</div><!-- fragment --><p>The benchmarks you subsequently run will have less variance.</p>
<p><a class="anchor" id="reducing-variance"></a></p>
<h1><a class="anchor" id="autotoc_md3890"></a>
Reducing Variance in Benchmarks</h1>
<p>The Linux CPU frequency governor <a href="user_guide#disabling-cpu-frequency-scaling">discussed above</a> is not the only source of noise in benchmarks. Some, but not all, of the sources of variance include:</p>
<ol type="1">
<li>On multi-core machines not all CPUs/CPU cores/CPU threads run the same speed, so running a benchmark one time and then again may give a different result depending on which CPU it ran on.</li>
<li>CPU scaling features that run on the CPU, like Intel's Turbo Boost and AMD Turbo Core and Precision Boost, can temporarily change the CPU frequency even when the using the "performance" governor on Linux.</li>
<li>Context switching between CPUs, or scheduling competition on the CPU the benchmark is running on.</li>
<li>Intel Hyperthreading or AMD SMT causing the same issue as above.</li>
<li>Cache effects caused by code running on other CPUs.</li>
<li>Non-uniform memory architectures (NUMA).</li>
</ol>
<p>These can cause variance in benchmarks results within a single run (<code>--benchmark_repetitions=N</code>) or across multiple runs of the benchmark program.</p>
<p>Reducing sources of variance is OS and architecture dependent, which is one reason some companies maintain machines dedicated to performance testing.</p>
<p>Some of the easier and and effective ways of reducing variance on a typical Linux workstation are:</p>
<ol type="1">
<li>Use the performance governer as <a href="user_guide#disabling-cpu-frequency-scaling">discussed above</a>.</li>
</ol>
<ol type="1">
<li>Disable processor boosting by: <div class="fragment"><div class="line">echo 0 | sudo tee /sys/devices/system/cpu/cpufreq/boost</div>
</div><!-- fragment --> See the Linux kernel's <a href="https://www.kernel.org/doc/Documentation/cpu-freq/boost.txt">boost.txt</a> for more information.</li>
<li>Set the benchmark program's task affinity to a fixed cpu. For example: <div class="fragment"><div class="line">taskset -c 0 ./mybenchmark</div>
</div><!-- fragment --></li>
<li>Disabling Hyperthreading/SMT. This can be done in the Bios or using the <code>/sys</code> file system (see the LLVM project's <a href="https://llvm.org/docs/Benchmarking.html">Benchmarking tips</a>).</li>
<li>Close other programs that do non-trivial things based on timers, such as your web browser, desktop environment, etc.</li>
<li>Reduce the working set of your benchmark to fit within the L1 cache, but do be aware that this may lead you to optimize for an unrelistic situation.</li>
</ol>
<p>Further resources on this topic:</p>
<ol type="1">
<li>The LLVM project's <a href="https://llvm.org/docs/Benchmarking.html">Benchmarking tips</a>.</li>
</ol>
<ol type="1">
<li>The Arch Wiki <a href="https://wiki.archlinux.org/title/CPU_frequency_scaling">Cpu frequency scaling</a> page. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
