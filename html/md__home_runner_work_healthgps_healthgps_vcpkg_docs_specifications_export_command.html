<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Health-GPS: Binary Export (Apr 28, 2017)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Health-GPS
   &#160;<span id="projectnumber">1.2.2.0</span>
   </div>
   <div id="projectbrief">Global Health Policy Simulation model (Health-GPS)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_runner_work_healthgps_healthgps_vcpkg_docs_specifications_export_command.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Binary Export (Apr 28, 2017) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Note: this is the feature as it was initially specified and does not necessarily reflect the current behavior.</b></p>
<h1><a class="anchor" id="autotoc_md3544"></a>
1. Motivation</h1>
<h2><a class="anchor" id="autotoc_md3545"></a>
A. Build once and share</h2>
<p>Customers want to be able to build their set of required libraries once, and then distribute the resulting binaries to all members of the "group". This has been brought up in</p><ul>
<li>Enterprise environments, in which there are dedicated teams to acquire libraries and then share them with other teams to consume them</li>
<li>Academic environments, in which the professor/teacher wants to build the required libraries and then provide them to all the students</li>
<li>CI Systems, in which developers want to quickly distribute their exact set of dependencies to a cloud-based farm of build machines</li>
</ul>
<p>Building once and sharing ensures that everyone gets exactly the same binaries, isolates the building effort to a small number of people and minimizes friction to obtain them. Therefore, there is value in enabling users to easily export ready-to-share binaries from <code>vcpkg</code>.</p>
<h2><a class="anchor" id="autotoc_md3546"></a>
B. Very large libraries</h2>
<p>Libraries like <a href="https://www.qt.io/">Qt</a> can take a very long time to build (5+ hours). Therefore, having the ability to build them and then distribute the binaries can save a lot of time.</p>
<h2><a class="anchor" id="autotoc_md3547"></a>
C. Flexibility and uses without &lt;tt&gt;vcpkg&lt;/tt&gt;</h2>
<p><code>vcpkg</code> currently handles cases where you have a <code>vcpkg</code> enlistment on your machine and use it for acquiring libraries and integrating into Visual Studio, CMake etc. However, users need the ability to build the libraries and then use them outside of and independently of <code>vcpkg</code>. For example:</p><ul>
<li>Use <code>vcpkg</code> for the build, then host the binaries in a website (similarly to nuget)</li>
<li>Use <code>vcpkg</code> for the build, then put the binaries in an installer and distribute the installer</li>
</ul>
<p>Consuming the libraries outside of <code>vcpkg</code> forfeits the ability to install new libraries or update existing ones, but this can be:</p><ul>
<li>not a concern, like in a short term project or assignment</li>
<li>explicitly desired, like in the development of a game where libraries and their versions are sealed for a particular release, never to be modified</li>
</ul>
<h2><a class="anchor" id="autotoc_md3548"></a>
D. Easy consumption in Visual Studio for NuGet users</h2>
<p>Customers have requested C++ NuGet packages to integrate into their project. This has come from:</p><ul>
<li>Customers than have used NuGet (e.g. in C#) and find it very convenient</li>
<li>Customers who are working on a C# project that has a few dependencies on C++ and just want those dependencies to be satisfied in the most automatic way possible</li>
</ul>
<p>Providing a way to create NuGet packages provides great value to those customers. In an enterprise environment which focuses on C#, the dedicated acquisition team can create the NuGet packages with <code>vcpkg</code> and provide them to the other developers. For the "end-developer", this makes the consumption of C++ libraries the same as C# ones.</p>
<h1><a class="anchor" id="autotoc_md3549"></a>
2. Other design concerns</h1>
<ul>
<li>The <code>vcpkg</code> root may have a variety of packages built and many of them might be unrelated to the current task. Providing an easy way to export a subset of them will enhance user experience.</li>
<li>Since binary compatibility is not guaranteed, it is not safe to individually export packages. Therefore, when exporting a particular package, all of the dependencies that it was built against must also be present in the export format (e.g. zip file). When a <code>vcpkg export</code> command succeeds, there is a guarantee that all required headers/binaries are available in the target bundle.</li>
</ul>
<h1><a class="anchor" id="autotoc_md3550"></a>
3. Proposed solution</h1>
<p>This document proposes the <code>vcpkg export</code> command to pack the desired binaries in a convenient format. It is not the goal of this document to discuss binary distribution for C++ in a similar way that NuGet does for C#. It proposes exporting "library sets" instead of individual libraries as a solution to the C++ binary incompatibility problem.</p>
<p>From a user experience perspective, the user expresses interest in exporting a particular library (e.g. <code>vcpkg export cpprestsdk</code>). <code>vcpkg export</code> should then make sure that the output contains <code>cpprestsdk</code> along with all dependencies it was actually built against.</p>
<h1><a class="anchor" id="autotoc_md3551"></a>
4. Proposed User experience</h1>
<h2><a class="anchor" id="autotoc_md3552"></a>
i. User knows what libraries he needs and wants to export them to an archive format (zip)</h2>
<p>Developer Bob needs gtest and cpprestsdk and has been manually building them and their dependencies, then using the binaries in his project via applocal deployment. Bob has been experimenting with <code>vcpkg</code> and wants to use <code>vcpkg</code> for the building part only.</p>
<p>Bob tries to export the libraries: </p><div class="fragment"><div class="line">&gt; vcpkg export gtest cpprestsdk --zip</div>
<div class="line">The following packages are already built and will be exported:</div>
<div class="line">  * boost:x86-windows</div>
<div class="line">  * bzip2:x86-windows</div>
<div class="line">    cpprestsdk:x86-windows</div>
<div class="line">  * openssl:x86-windows</div>
<div class="line">  * websocketpp:x86-windows</div>
<div class="line">  * zlib:x86-windows</div>
<div class="line">The following packages need to be built:</div>
<div class="line">    gtest:x86-windows</div>
<div class="line">Additional packages (*) need to be exported to complete this operation.</div>
<div class="line">There are packages that have not been built.</div>
<div class="line">To build them, run:</div>
<div class="line">    vcpkg install gtest:x86-windows</div>
</div><!-- fragment --><p>Bob proceeds to install the missing libraries: </p><div class="fragment"><div class="line">&gt; vcpkg install gtest:x86-windows</div>
<div class="line">// -- omitted build information -- //</div>
<div class="line">Package gtest:x86-windows is installed.</div>
</div><!-- fragment --><p>Bob then returns to export the libraries: </p><div class="fragment"><div class="line">&gt; vcpkg export gtest cpprestsdk --zip</div>
<div class="line">The following packages are already built and will be exported:</div>
<div class="line">  * boost:x86-windows</div>
<div class="line">  * bzip2:x86-windows</div>
<div class="line">    cpprestsdk:x86-windows</div>
<div class="line">    gtest:x86-windows</div>
<div class="line">  * openssl:x86-windows</div>
<div class="line">  * websocketpp:x86-windows</div>
<div class="line">  * zlib:x86-windows</div>
<div class="line">Additional packages (*) need to be exported to complete this operation.</div>
<div class="line">Exporting package zlib:x86-windows...</div>
<div class="line">Exporting package zlib:x86-windows... done</div>
<div class="line">Exporting package openssl:x86-windows...</div>
<div class="line">Exporting package openssl:x86-windows... done</div>
<div class="line">Exporting package bzip2:x86-windows...</div>
<div class="line">Exporting package bzip2:x86-windows... done</div>
<div class="line">Exporting package boost:x86-windows...</div>
<div class="line">Exporting package boost:x86-windows... done</div>
<div class="line">Exporting package websocketpp:x86-windows...</div>
<div class="line">Exporting package websocketpp:x86-windows... done</div>
<div class="line">Exporting package cpprestsdk:x86-windows...</div>
<div class="line">Exporting package cpprestsdk:x86-windows... done</div>
<div class="line">Exporting package gtest:x86-windows...</div>
<div class="line">Exporting package gtest:x86-windows... done</div>
<div class="line">Creating zip archive...</div>
<div class="line">Creating zip archive... done</div>
<div class="line">zip archive exported at: C:/vcpkg/vcpkg-export-20170428-155351.zip</div>
</div><!-- fragment --><p>Bob takes the zip file and extracts the contents next to his other dependencies. Bob can now proceed with building his own project as before.</p>
<h2><a class="anchor" id="autotoc_md3553"></a>
ii. User has a vcpkg root that works and wants to share it</h2>
<p>Developer Alice has been using <code>vcpkg</code> and has a Visual Studio project that consumes libraries from it (via <code>vcpkg integrate</code>). The project is built for both 32-bit and 64-bit architectures. Alice wants to quickly share the dependencies with Bob so he can test the project. </p><div class="fragment"><div class="line">&gt; vcpkg export gtest zlib gtest:x64-windows zlib:x64-windows --nuget</div>
<div class="line">The following packages are already built and will be exported:</div>
<div class="line">    gtest:x86-windows</div>
<div class="line">    gtest:x64-windows</div>
<div class="line">    zlib:x86-windows</div>
<div class="line">    zlib:x64-windows</div>
<div class="line">Exporting package zlib:x86-windows...</div>
<div class="line">Exporting package zlib:x86-windows... done</div>
<div class="line">Exporting package zlib:x64-windows...</div>
<div class="line">Exporting package zlib:x64-windows... done</div>
<div class="line">Exporting package gtest:x86-windows...</div>
<div class="line">Exporting package gtest:x86-windows... done</div>
<div class="line">Exporting package gtest:x64-windows...</div>
<div class="line">Exporting package gtest:x64-windows... done</div>
<div class="line">Creating nuget package...</div>
<div class="line">Creating nuget package... done</div>
<div class="line">Nuget package exported at: C:/vcpkg/scripts/buildsystems/tmp/vcpkg-export-20170428-164312.nupkg</div>
</div><!-- fragment --><p>Alice gives to Bob: a) The link to her project and b) The NuGet package "vcpkg-export-20170428-164312.nupkg". Bob clones the project and then installs the NuGet package. Bob is now ready to build Alice's project.</p>
<h2><a class="anchor" id="autotoc_md3554"></a>
iii. User has a vcpkg root that works and wants to share it #2</h2>
<p>Developer Alice has been using <code>vcpkg</code> and has a CMake project that consumes libraries from it (via CMake toolchain file). Alice wants to quickly share the dependencies with Bob so he can test the project. </p><div class="fragment"><div class="line">&gt; vcpkg export cpprestsdk zlib --zip</div>
<div class="line">The following packages are already built and will be exported:</div>
<div class="line">  * boost:x86-windows</div>
<div class="line">  * bzip2:x86-windows</div>
<div class="line">    cpprestsdk:x86-windows</div>
<div class="line">  * openssl:x86-windows</div>
<div class="line">  * websocketpp:x86-windows</div>
<div class="line">    zlib:x86-windows</div>
<div class="line">Additional packages (*) need to be exported to complete this operation.</div>
<div class="line">Exporting package zlib:x86-windows...</div>
<div class="line">Exporting package zlib:x86-windows... done</div>
<div class="line">Exporting package openssl:x86-windows...</div>
<div class="line">Exporting package openssl:x86-windows... done</div>
<div class="line">Exporting package bzip2:x86-windows...</div>
<div class="line">Exporting package bzip2:x86-windows... done</div>
<div class="line">Exporting package boost:x86-windows...</div>
<div class="line">Exporting package boost:x86-windows... done</div>
<div class="line">Exporting package websocketpp:x86-windows...</div>
<div class="line">Exporting package websocketpp:x86-windows... done</div>
<div class="line">Exporting package cpprestsdk:x86-windows...</div>
<div class="line">Exporting package cpprestsdk:x86-windows... done</div>
<div class="line">Creating zip archive...</div>
<div class="line">Creating zip archive... done</div>
<div class="line">zip archive exported at: C:/vcpkg/vcpkg-export-20170428-155351.zip</div>
</div><!-- fragment --><p>Alice gives to Bob: a) The links to her project and b) The zip file "vcpkg-export-20170428-155351.zip". Bob clones the project, extracts the zip file and uses the provided (in the zip) CMake toolchain file to make the dependencies available to CMake. Bob is now ready to build Alice's project.</p>
<h1><a class="anchor" id="autotoc_md3555"></a>
5. Technical model</h1>
<ul>
<li>Each exported library, must be accompanied with all of its dependencies, even if they are not explicitly specified in the <code>vcpkg export</code> command.</li>
<li>When exporting a library, a dependency graph will be built, similarly to install, to figure out which packages need to be exported.</li>
<li>It is allowed to have packages from different triplets, so users can include 32/64-bit and dynamic/static binaries in the same export.</li>
<li>The exported archives also include the files needed to integrate with MSBuild and/or CMake. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
