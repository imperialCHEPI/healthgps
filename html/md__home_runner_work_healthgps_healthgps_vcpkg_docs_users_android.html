<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Health-GPS: Vcpkg and Android</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Health-GPS
   &#160;<span id="projectnumber">1.2.2.0</span>
   </div>
   <div id="projectbrief">Global Health Policy Simulation model (Health-GPS)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_runner_work_healthgps_healthgps_vcpkg_docs_users_android.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Vcpkg and Android </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>The latest version of this documentation is available on <a href="https://github.com/Microsoft/vcpkg/tree/master/docs/users/android.md">GitHub</a>.</b></p>
<p><em>Android is not tested as part of vcpkg repository's CI process, so regressions can occur as part of library updates. PRs improving support are welcome!</em></p>
<h1><a class="anchor" id="autotoc_md3659"></a>
Android build requirements</h1>
<ol type="1">
<li>Download the <a href="https://developer.android.com/ndk/downloads/">android ndk</a></li>
<li>Set environment variable <code>ANDROID_NDK_HOME</code> to your android ndk installation. For example:</li>
</ol>
<div class="fragment"><div class="line">export ANDROID_NDK_HOME=/home/your-account/Android/Sdk/ndk-bundle</div>
</div><!-- fragment --><p>Or: </p><div class="fragment"><div class="line">export ANDROID_NDK_HOME=/home/your-account/Android/android-ndk-r21b</div>
</div><!-- fragment --><ol type="1">
<li>Install <a href="https://github.com/microsoft/vcpkg">vcpkg</a></li>
<li>Set environment variable <code>VCPKG_ROOT</code> to your vcpkg installation. <div class="fragment"><div class="line">export VCPKG_ROOT=/path/to/vcpkg</div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="autotoc_md3660"></a>
vcpkg triplets and their corresponding android ABI</h1>
<p>There are four different Android ABI, each of which maps to a vcpkg triplet. The following table outlines the mapping from vcpkg architectures to android architectures</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">VCPKG_TARGET_TRIPLET   </th><th class="markdownTableHeadNone">ANDROID_ABI    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">arm64-android   </td><td class="markdownTableBodyNone">arm64-v8a    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">arm-android   </td><td class="markdownTableBodyNone">armeabi-v7a    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">x64-android   </td><td class="markdownTableBodyNone">x86_64    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">x86-android   </td><td class="markdownTableBodyNone">x86   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md3661"></a>
Install libraries for Android using vcpkg</h1>
<p>Example for jsoncpp:</p>
<div class="fragment"><div class="line">cd $VCPKG_ROOT</div>
<div class="line"> </div>
<div class="line"># specify the triplet like this</div>
<div class="line">./vcpkg install jsoncpp --triplet arm-android   </div>
<div class="line"># or like this</div>
<div class="line">./vcpkg install jsoncpp:arm64-android           </div>
<div class="line">./vcpkg install jsoncpp:x86-android</div>
<div class="line">./vcpkg install jsoncpp:x64-android</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3662"></a>
Using Vulkan SDK</h2>
<p>Vcpkg has a <a href="https://github.com/microsoft/vcpkg/blob/master/ports/vulkan/portfile.cmake"><code>vulkan</code> package</a> which allows you to <code>find_package(Vulkan)</code>. To use it you have to provide <code>VULKAN_SDK</code> environment variable.</p>
<div class="fragment"><div class="line">export VULKAN_SDK=/usr/local</div>
<div class="line">./vcpkg install vulkan</div>
</div><!-- fragment --><p>NDK already contains <a href="https://developer.android.com/ndk/guides/graphics/getting-started">Vulkan</a> headers and <code>libvulkan.so</code> binaries for each of its architecture. <br  />
 To expose them to VcPkg, you can consider <code>export VULKAN_SDK=...</code> for each installation. <br  />
 But by placing <code>set(ENV{VULKAN_SDK} ...)</code> in the triplet files, you can skip the tedious work.</p>
<p>If you are using NDK 21.3.6528147 or earlier version, it will be like the following.</p>
<div class="fragment"><div class="line"># In android triplets... (e.g. arm64-android.cmake)</div>
<div class="line">set(VCPKG_CMAKE_SYSTEM_NAME Android)</div>
<div class="line"># ...</div>
<div class="line"># If your API level is 30, libvulkan.so is at $ENV{ANDROID_NDK_HOME}/platforms/android-30/arch-arm64/usr/lib</div>
<div class="line">set(ENV{VULKAN_SDK} $ENV{ANDROID_NDK_HOME}/sysroot/usr)</div>
</div><!-- fragment --><p>Notice that <b>the location of the sysroot has changed since NDK 22</b>. (see <a href="https://github.com/android/ndk/issues/1407">https://github.com/android/ndk/issues/1407</a>) <br  />
 If you prefer using <a href="https://developer.android.com/studio/projects/install-ndk#default-ndk-per-agp">the latest version</a>, check the <a href="https://android.googlesource.com/platform/ndk/+/master/docs/BuildSystemMaintainers.md#sysroot">BuildSystemMaintainers.md of the NDK document</a> and then put appropriate path for your system.</p>
<p>For example, Mac OS users will use the path like this.</p>
<div class="fragment"><div class="line"># In android triplets... (e.g. arm64-android.cmake)</div>
<div class="line">set(VCPKG_CMAKE_SYSTEM_NAME Android)</div>
<div class="line"># ...</div>
<div class="line"># If your API level is 30, libvulkan.so is at $ENV{ANDROID_NDK_HOME}/toolchains/llvm/prebuilt/darwin-x86_64/sysroot/usr/lib/aarch64-linux-android/30</div>
<div class="line">set(ENV{VULKAN_SDK} $ENV{ANDROID_NDK_HOME}/toolchains/llvm/prebuilt/darwin-x86_64/sysroot/usr)</div>
</div><!-- fragment --><p>By doing this for all android triplets, you can install <code>vulkan</code> and the packages that require it. (e.g. <code>vulkan-hpp</code>)</p>
<p>&lt;details&gt; </p>
<p><code>vcpkg install vulkan-hpp:arm64-android</code></p>
<div class="fragment"><div class="line">user@host$ ./vcpkg install vulkan-hpp:arm64-android</div>
<div class="line">Computing installation plan...</div>
<div class="line">The following packages will be built and installed:</div>
<div class="line">  * vulkan[core]:arm64-android -&gt; 1.1.82.1-1</div>
<div class="line">    vulkan-hpp[core]:arm64-android -&gt; 2019-05-11-1</div>
<div class="line">Additional packages (*) will be modified to complete this operation.</div>
<div class="line">Detecting compiler hash for triplet arm64-android...</div>
<div class="line">...</div>
<div class="line">Starting package 1/2: vulkan:arm64-android</div>
<div class="line">Building package vulkan[core]:arm64-android...</div>
<div class="line">-- Using community triplet arm64-android. This triplet configuration is not guaranteed to succeed.</div>
<div class="line">-- [COMMUNITY] Loading triplet configuration from: /.../vcpkg/triplets/community/arm64-android.cmake</div>
<div class="line">-- Querying VULKAN_SDK Environment variable</div>
<div class="line">-- Searching /.../Library/Android/sdk/ndk/22.1.7171670/toolchains/llvm/prebuilt/darwin-x86_64/sysroot/usr/include/vulkan/ for vulkan.h</div>
<div class="line">-- Found vulkan.h</div>
<div class="line">-- Performing post-build validation</div>
<div class="line">-- Performing post-build validation done</div>
<div class="line">...</div>
<div class="line">Building package vulkan[core]:arm64-android... done</div>
<div class="line">Installing package vulkan[core]:arm64-android...</div>
<div class="line">Installing package vulkan[core]:arm64-android... done</div>
<div class="line">Elapsed time for package vulkan:arm64-android: 35.9 ms</div>
<div class="line">Starting package 2/2: vulkan-hpp:arm64-android</div>
<div class="line">Building package vulkan-hpp[core]:arm64-android...</div>
<div class="line">-- Using community triplet arm64-android. This triplet configuration is not guaranteed to succeed.</div>
<div class="line">-- [COMMUNITY] Loading triplet configuration from: /.../vcpkg/triplets/community/arm64-android.cmake</div>
<div class="line">-- Using cached /.../vcpkg/downloads/KhronosGroup-Vulkan-Hpp-5ce8ae7fd0d9c0543d02f33cfa8a66e6a43e2150.tar.gz</div>
<div class="line">-- Cleaning sources at /.../vcpkg/buildtrees/vulkan-hpp/src/e6a43e2150-4f344cd911.clean. Use --editable to skip cleaning for the packages you specify.</div>
<div class="line">-- Extracting source /.../vcpkg/downloads/KhronosGroup-Vulkan-Hpp-5ce8ae7fd0d9c0543d02f33cfa8a66e6a43e2150.tar.gz</div>
<div class="line">-- Using source at /.../vcpkg/buildtrees/vulkan-hpp/src/e6a43e2150-4f344cd911.clean</div>
<div class="line">-- Performing post-build validation</div>
<div class="line">-- Performing post-build validation done</div>
<div class="line">...</div>
<div class="line">Building package vulkan-hpp[core]:arm64-android... done</div>
<div class="line">Installing package vulkan-hpp[core]:arm64-android...</div>
<div class="line">Installing package vulkan-hpp[core]:arm64-android... done</div>
<div class="line">Elapsed time for package vulkan-hpp:arm64-android: 144.5 ms</div>
<div class="line"> </div>
<div class="line">Total elapsed time: 1.013 s</div>
<div class="line"> </div>
<div class="line">The package vulkan-hpp:arm64-android is header only and can be used from CMake via:</div>
<div class="line"> </div>
<div class="line">    find_path(VULKAN_HPP_INCLUDE_DIRS &quot;vulkan/vulkan.hpp&quot;)</div>
<div class="line">    target_include_directories(main PRIVATE ${VULKAN_HPP_INCLUDE_DIRS})</div>
</div><!-- fragment --><p>&lt;/details&gt;</p>
<h1><a class="anchor" id="autotoc_md3663"></a>
Consume libraries using vpckg, cmake and the android toolchain</h1>
<ol type="1">
<li>Combine vcpkg and Android toolchains</li>
</ol>
<p>vcpkg and android both provide dedicated toolchains: </p><div class="fragment"><div class="line">vcpkg_toolchain_file=$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake</div>
<div class="line">android_toolchain_file=$ANDROID_NDK_HOME/build/cmake/android.toolchain.cmake</div>
</div><!-- fragment --><p>When using vcpkg, the vcpkg toolchain shall be specified first.</p>
<p>However, vcpkg provides a way to preload and additional toolchain, with the VCPKG_CHAINLOAD_TOOLCHAIN_FILE option.</p>
<div class="fragment"><div class="line">cmake \</div>
<div class="line">  -DCMAKE_TOOLCHAIN_FILE=$vcpkg_toolchain_file \</div>
<div class="line">  -DVCPKG_CHAINLOAD_TOOLCHAIN_FILE=$android_toolchain_file \</div>
<div class="line">  ...</div>
</div><!-- fragment --><ol type="1">
<li>Specify the android abi and vcpkg triplet</li>
</ol>
<p>When compiling for android, you need to select a matching "android abi" / "vcpkg triplet" pair.</p>
<p>For example:</p>
<div class="fragment"><div class="line">android_abi=armeabi-v7a</div>
<div class="line">vcpkg_target_triplet=arm-android</div>
<div class="line"> </div>
<div class="line">cmake </div>
<div class="line">  ...</div>
<div class="line">  -DVCPKG_TARGET_TRIPLET=$vcpkg_target_triplet \</div>
<div class="line">  -DANDROID_ABI=$android_abi</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md3664"></a>
Test on an example</h2>
<p>The folder <a href="../examples/vcpkg_android_example_cmake">docs/examples/vcpkg_android_example_cmake</a> provides a working example, with an android library that consumes the jsoncpp library:</p>
<p><em>Details</em></p>
<ul>
<li>The <a href="../examples/vcpkg_android_example_cmake/CMakeLists.txt">CMakeLists</a> simply uses <code>find_package</code> and <code>target_link_library</code></li>
<li>The <a href="../examples/vcpkg_android_example_cmake/compile.sh">compile.sh</a> script enables you to select any matching pair of "android abi" / "vcpkg triplet" and to test the compilation</li>
<li>The dummy <a href="../examples/vcpkg_android_example_cmake/my_lib.cpp">my_lib.cpp</a> file uses the jsoncpp library</li>
</ul>
<p><em>Note</em>: this example only compiles an Android library, as the compilation of a full fledged Android App is beyond the scope of this document.</p>
<h2><a class="anchor" id="autotoc_md3665"></a>
Test on an example, using &lt;a href="../examples/vcpkg_android_example_cmake_script/cmake/vcpkg_android.cmake"&gt;vcpkg_android.cmake&lt;/a&gt;</h2>
<p>The folder <a href="../examples/vcpkg_android_example_cmake_script">docs/examples/vcpkg_android_example_cmake_script</a> provides the same example, and uses a cmake script in order to simplify the usage.</p>
<p><em>Details</em></p>
<ul>
<li>The main <a href="../examples/vcpkg_android_example_cmake_script/CMakeLists.txt">CMakeLists</a> loads <a href="../examples/vcpkg_android_example_cmake_script/cmake/vcpkg_android.cmake">vcpkg_android.cmake</a> if the flag <code>VCPKG_TARGET_ANDROID</code> is set: <div class="fragment"><div class="line">if (VCPKG_TARGET_ANDROID)</div>
<div class="line">    include(&quot;cmake/vcpkg_android.cmake&quot;)</div>
<div class="line">endif()</div>
</div><!-- fragment --> <em>Important: place these lines before calling <a class="el" href="namespaceconf.html#a45653c983098153b78e33600e39230eb">project()</a> !</em></li>
<li>The <a href="../examples/vcpkg_android_example_cmake_script/compile.sh">compile.sh</a> script shows that it is then possible to compile for android using a simple cmake invocation, for example: <div class="fragment"><div class="line">cmake .. -DVCPKG_TARGET_ANDROID=ON -DANDROID_ABI=armeabi-v7a</div>
</div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="autotoc_md3666"></a>
Consume libraries using vcpkg, and Android prefab Archives (AAR files)</h1>
<p>See <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_specifications_prefab.html">prefab.md</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
