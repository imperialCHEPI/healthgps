<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Health-GPS: Creating Registries</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Health-GPS
   &#160;<span id="projectnumber">1.2.2.0</span>
   </div>
   <div id="projectbrief">Global Health Policy Simulation model (Health-GPS)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_runner_work_healthgps_healthgps_vcpkg_docs_maintainers_registries.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Creating Registries </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>The latest version of this documentation is available on <a href="https://github.com/Microsoft/vcpkg/tree/master/docs/maintainers/registries.md">GitHub</a>.</b></p>
<p>There are two parts to using registries; this documents the creation side of the relationship. In order to learn more about using registries that others have created, please read <a class="el" href="md__home_runner_work_healthgps_healthgps_vcpkg_docs_users_registries.html">this documentation</a>. </p>
<h1><a class="anchor" id="autotoc_md3232"></a>
Table of Contents</h1>
<ul>
<li><a href="#creating-registries">Creating Registries</a><ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#overview">Overview</a><ul>
<li><a href="#git-registries">Git Registries</a><ul>
<li><a href="#adding-a-new-version">Adding a New Version</a></li>
</ul>
</li>
<li><a href="#filesystem-registries">Filesystem Registries</a><ul>
<li><a href="#adding-a-new-version-1">Adding a New Version</a></li>
</ul>
</li>
<li><a href="#builtin-registries">Builtin Registries</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md3233"></a>
Overview</h1>
<p>Registries are collections of ports and their versions. There are two major choices of implementation for registries, if you want to create your own - git registries, and filesystem registries.</p>
<p>Git registries are simple git repositories, and can be shared publicly or privately via normal mechanisms for git repositories. The vcpkg repository at <a href="https://github.com/microsoft/vcpkg">https://github.com/microsoft/vcpkg</a>, for example, is a git registry.</p>
<p>Filesystem registries are designed as more of a testing ground. Given that they literally live on your filesystem, the only way to share them is via shared directories. However, filesystem registries can be useful as a way to represent registries held in non-git version control systems, assuming one has some way to get the registry onto the disk.</p>
<p>Note that we expect the set of registry types to grow over time; if you would like support for registries built in your favorite public version control system, don't hesitate to open a PR.</p>
<p>The basic structure of a registry is:</p>
<ul>
<li>The set of versions that are considered "latest" at certain times in history, known as the "baseline".</li>
<li>The set of all the versions of all the ports, and where to find each of these in the registry.</li>
</ul>
<h2><a class="anchor" id="autotoc_md3234"></a>
Git Registries</h2>
<p>As you're following along with this documentation, it may be helpful to have a working example to refer to. We've written one and put it here: <a href="https://github.com/northwindtraders/vcpkg-registry">https://github.com/northwindtraders/vcpkg-registry</a>.</p>
<p>All git registries must have a <code>versions/baseline.json</code> file. This file contains the set of "latest versions" at a certain commit. It is laid out as a top-level object containing only the <code>"default"</code> field. This field should contain an object mapping port names to the version which is currently the latest.</p>
<p>Here's an example of a valid baseline.json:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;default&quot;: {</div>
<div class="line">    &quot;kitten&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;2.6.2&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0</div>
<div class="line">    },</div>
<div class="line">    &quot;port-b&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;19.00&quot;,</div>
<div class="line">      &quot;port-version&quot;: 2</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>versions</code> directory contains all the information about which versions of which packages are contained in the registry, along with where those versions are stored. The rest of the registry just acts as a backing store, as far as vcpkg is concerned: only things inside the <code>versions</code> directory will be used to direct how your registry is seen by vcpkg.</p>
<p>Each port in a registry should exist in the versions directory as <code>&lt;first letter of port&gt;-/&lt;name of port&gt;.json</code>; in other words, the information about the <code>kitten</code> port would be located in <code>versions/k-/kitten.json</code>. This should be a top-level object with only a single field: <code>"versions"</code>. This field should contain an array of version objects:</p>
<ul>
<li>The version of the port in question; should be exactly the same as the <code>vcpkg.json</code> file, including the version fields and <code>"port-version"</code>.</li>
<li>The <code>"git-tree"</code> field, which is a git tree; in other words, what you get when you write <code>git rev-parse COMMIT-ID:path/to/port</code>.</li>
</ul>
<p>Note that the version fields for ports with <code>CONTROL</code> files, is <code>"version-string"</code>; we do not recommend using <code>CONTROL</code> files in new registries, however.</p>
<p><em>WARNING</em>: One very important part of registries is that versions should <em>never</em> be changed. Updating to a later ref should never remove or change an existing version. It must always be safe to update a registry.</p>
<p>Here's an example of a valid version database for a <code>kitten</code> port with one version:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;versions&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;version&quot;: &quot;2.6.2&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0,</div>
<div class="line">      &quot;git-tree&quot;: &quot;67d60699c271b7716279fdea5a5c6543929eb90e&quot;</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>In general, it's not important where you place port directories. However, the idiom in vcpkg is to follow what the built in vcpkg registry does: your <code>kitten</code> port should be placed in <code>ports/kitten</code>.</p>
<p><em>WARNING</em>: One other thing to keep in mind is that when you update a registry, all previous versions should also be accessible. Since your user will set their baseline to a commit ID, that commit ID must always exist, and be accessible from your HEAD commit, which is what is actually fetched. This means that your HEAD commit should be a child of all previous HEAD commits.</p>
<h2><a class="anchor" id="autotoc_md3235"></a>
Builtin Registries</h2>
<p>Builtin registries are treated as special <a href="#git-registries">Git registries</a>. Instead of fetching from a remote url, builtin registries consult the <code>$VCPKG_ROOT/.git</code> directory of the vcpkg clone. They use the currently checked out <code>$VCPKG_ROOT/versions</code> directory as the source for versioning information.</p>
<h3><a class="anchor" id="autotoc_md3236"></a>
Adding a New Version</h3>
<p>There is some git trickery involved in creating a new version of a port. The first thing to do is make some changes, update the <code>"port-version"</code> and regular version field as you need to, and then test with <code>overlay-ports</code>: <code>vcpkg install kitten --overlay-ports=ports/kitten</code>.</p>
<p>Once you've finished your testing, you'll need to make sure that the directory as it is is under git's purview. You'll do this by creating a temporary commit:</p>
<div class="fragment"><div class="line">&gt; git add ports/kitten</div>
<div class="line">&gt; git commit -m &#39;temporary commit&#39;</div>
</div><!-- fragment --><p>Then, get the git tree ID of the directory:</p>
<div class="fragment"><div class="line">&gt; git rev-parse HEAD:ports/kitten</div>
<div class="line">73ad3c823ef701c37421b450a34271d6beaf7b07</div>
</div><!-- fragment --><p>Then, you can add this version to the versions database. At the top of your <code>versions/k-/kitten.json</code>, you can add (assuming you're adding version <code>2.6.3#0</code>):</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;versions&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;version&quot;: &quot;2.6.3&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0,</div>
<div class="line">      &quot;git-tree&quot;: &quot;73ad3c823ef701c37421b450a34271d6beaf7b07&quot;</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      &quot;version&quot;: &quot;2.6.2&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0,</div>
<div class="line">      &quot;git-tree&quot;: &quot;67d60699c271b7716279fdea5a5c6543929eb90e&quot;</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p>then, you'll want to modify your <code>versions/baseline.json</code> with your new version as well:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;default&quot;: {</div>
<div class="line">    &quot;kitten&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;2.6.3&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0</div>
<div class="line">    },</div>
<div class="line">    &quot;port-b&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;19.00&quot;,</div>
<div class="line">      &quot;port-version&quot;: 2</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>and amend your current commit:</p>
<div class="fragment"><div class="line">&gt; git commit --amend</div>
</div><!-- fragment --><p>then share away!</p>
<h2><a class="anchor" id="autotoc_md3237"></a>
Filesystem Registries</h2>
<p>As you're following along with this documentation, it may be helpful to have a working example to refer to. We've written one and put it here: <a href="https://github.com/vcpkg/example-filesystem-registry">https://github.com/vcpkg/example-filesystem-registry</a>.</p>
<p>All filesystem registries must have a <code>versions/baseline.json</code> file. This file contains the set of "latest versions" for a certain version of the registry. It is laid out as a top-level object containing a map from version name to "baseline objects", which map port names to the version which is considered "latest" for that version of the registry.</p>
<p>Filesystem registries need to decide on a versioning scheme. Unlike git registries, which have the implicit versioning scheme of refs, filesystem registries can't rely on the version control system here. One possible option is to do a daily release, and have your "versions" be dates.</p>
<p><em>WARNING</em>: A baseline must not be modified once published. If you want to change or update versions, you need to create a new baseline in the <code>baseline.json</code> file.</p>
<p>Here's an example of a valid <code>baseline.json</code>, for a registry that has decided upon dates for their versions:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">  &quot;2021-04-16&quot;: {</div>
<div class="line">    &quot;kitten&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;2.6.2&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0</div>
<div class="line">    },</div>
<div class="line">    &quot;port-b&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;19.00&quot;,</div>
<div class="line">      &quot;port-version&quot;: 2</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;2021-04-15&quot;: {</div>
<div class="line">    &quot;kitten&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;2.6.2&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0</div>
<div class="line">    },</div>
<div class="line">    &quot;port-b&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;19.00&quot;,</div>
<div class="line">      &quot;port-version&quot;: 1</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The <code>versions</code> directory contains all the information about which versions of which packages are contained in the registry, along with where those versions are stored. The rest of the registry just acts as a backing store, as far as vcpkg is concerned: only things inside the <code>versions</code> directory will be used to direct how your registry is seen by vcpkg.</p>
<p>Each port in a registry should exist in the versions directory as <code>&lt;first letter of port&gt;-/&lt;name of port&gt;.json</code>; in other words, the information about the <code>kitten</code> port would be located in <code>versions/k-/kitten.json</code>. This should be a top-level object with only a single field: <code>"versions"</code>. This field should contain an array of version objects:</p>
<ul>
<li>The version of the port in question; should be exactly the same as the <code>vcpkg.json</code> file, including the version fields and <code>"port-version"</code>.</li>
<li>The <code>"path"</code> field: a relative directory, rooted at the base of the registry (in other words, the directory where <code>versions</code> is located), to the port directory. It should look something like <code>"$/path/to/port/dir&lt;/tt&gt;"</code></li>
</ul>
<p><code>Note that the version fields for ports with <code>CONTROL</code> files, is <code>"version-string"</code>; we do not recommend using <code>CONTROL</code> files in new registries, however.</code></p>
<p><code>In general, it's not important where you place port directories. However, the idiom in vcpkg is to follow somewhat closely to what the built in vcpkg registry does: your <code>kitten</code> port at version <code>x.y.z</code> should be placed in <code>ports/kitten/x.y.z</code>, with port versions appended as you see fit (although since <code>#</code> is not a good character to use for file names, perhaps use <code>_</code>).</code></p>
<p><code><em>WARNING</em>: One very important part of registries is that versions should <em>never</em> be changed. One should never remove or change an existing version. Your changes to your registry shouldn't change behavior to downstream users.</code></p>
<p><code>Here's an example of a valid version database for a <code>kitten</code> port with one version:</code></p>
<p><code></p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;versions&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;version&quot;: &quot;2.6.2&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0,</div>
<div class="line">      &quot;path&quot;: &quot;$/ports/kitten/2.6.2_0&quot;</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p></code></p>
<p><code></code></p>
<h3><a class="anchor" id="autotoc_md3238"></a>
Adding a New Version</h3>
<p><code> Unlike git registries, adding a new version to a filesystem registry mostly involves a lot of copying. The first thing to do is to copy the latest version of your port into a new version directory, update the version and <code>"port-version"</code> fields as you need to, and then test with <code>overlay-ports</code>: <code>vcpkg install kitten --overlay-ports=ports/kitten/new-version</code>.</code></p>
<p><code>Once you've finished your testing, you can add this new version to the top of your <code>versions/k-/kitten.json</code>:</code></p>
<p><code></p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;versions&quot;: [</div>
<div class="line">    {</div>
<div class="line">      &quot;version&quot;: &quot;2.6.3&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0,</div>
<div class="line">      &quot;path&quot;: &quot;$/ports/kitten/2.6.3_0&quot;</div>
<div class="line">    },</div>
<div class="line">    {</div>
<div class="line">      &quot;version&quot;: &quot;2.6.2&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0,</div>
<div class="line">      &quot;path&quot;: &quot;$/ports/kitten/2.6.2_0&quot;</div>
<div class="line">    }</div>
<div class="line">  ]</div>
<div class="line">}</div>
</div><!-- fragment --><p></code></p>
<p><code>then, you'll want to modify your <code>versions/baseline.json</code> with your new version as well (remember not to modify existing baselines):</code></p>
<p><code></p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;2021-04-17&quot;: {</div>
<div class="line">    &quot;kitten&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;2.6.3&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0</div>
<div class="line">    },</div>
<div class="line">    &quot;port-b&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;19.00&quot;,</div>
<div class="line">      &quot;port-version&quot;: 2</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;2021-04-16&quot;: {</div>
<div class="line">    &quot;kitten&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;2.6.2&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0</div>
<div class="line">    },</div>
<div class="line">    &quot;port-b&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;19.00&quot;,</div>
<div class="line">      &quot;port-version&quot;: 2</div>
<div class="line">    }</div>
<div class="line">  },</div>
<div class="line">  &quot;2021-04-15&quot;: {</div>
<div class="line">    &quot;kitten&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;2.6.2&quot;,</div>
<div class="line">      &quot;port-version&quot;: 0</div>
<div class="line">    },</div>
<div class="line">    &quot;port-b&quot;: {</div>
<div class="line">      &quot;baseline&quot;: &quot;19.00&quot;,</div>
<div class="line">      &quot;port-version&quot;: 1</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p></code></p>
<p><code>and you're done! </code></p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
