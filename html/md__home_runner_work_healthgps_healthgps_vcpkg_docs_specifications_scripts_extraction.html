<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Health-GPS: Scripts Tree Extraction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Health-GPS
   &#160;<span id="projectnumber">1.2.2.0</span>
   </div>
   <div id="projectbrief">Global Health Policy Simulation model (Health-GPS)</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_runner_work_healthgps_healthgps_vcpkg_docs_specifications_scripts_extraction.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Scripts Tree Extraction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Note: this is the feature as it was initially specified and does not necessarily reflect the current behavior.</b></p>
<h1><a class="anchor" id="autotoc_md3627"></a>
Background</h1>
<p>We extracted vcpkg-tool as part of a future wherein Registries are the primary mechanism for interacting with the ports tree, which would allow the vcpkg tool and associated artifacts to be deployed and figure the rest out on their own. Unfortunately, we have concurrently edited things in the so called "scripts" tree which lives in support of ports but really probably belongs in the vcpkg-tool repo.</p>
<p>Moreover, as part of stabilizing registries, the interface exposed by the scripts tree becomes contractual rather than something we can change in concert with ports, since we can no longer see the universe of ports to validate that changes are correct.</p>
<p>To that end we are auditing the contents of the scripts tree to make sure it is a solid foundation for future work.</p>
<p>The work list is contained in <a href="https://github.com/microsoft/vcpkg/issues/16188">Issue #16188</a>.</p>
<h1><a class="anchor" id="autotoc_md3628"></a>
Audit Points</h1>
<p>The following are assertions we want to be able to make about the contents of the scripts tree. Note that this does <em>not</em> refer to <code>vcpkg.cmake</code> since that needs to work with older versions of cmake.</p>
<p>These are design ideals that we may break in some limited cases where that makes sense.</p>
<ul>
<li>We always use <code>cmake_parse_arguments</code> rather than function parameters, or referring to <code>${ARG&lt;N&gt;}</code>.<ul>
<li>Exception: there are exclusively positional parameters. This should be <em>very rare</em>.<ul>
<li>In this case, positional parameters should be put in the function declaration (rather than using <code>${ARG&lt;N&gt;}</code>), and should be named according to local rules (i.e. <code>snake_case</code>).</li>
<li>Exception: positional parameters that are optional should be given a name via <code>set(argument_name "${ARG&lt;N&gt;}") after checking</code>${ARGC}<code>.</code></li>
</ul>
</li>
<li><code>Note: in cases where there are positional parameters along with non-positional parameters, positional parameters should be referred to by</code>arg_UNPARSED_ARGUMENTS<code>.</code></li>
</ul>
</li>
<li><code>All</code>cmake_parse_arguments<code>use</code>PARSE_ARGV<code>for resistance to embedded semicolons.</code></li>
<li><code>All</code>foreach<code>loops use</code>IN LISTS<code>for resistance to embedded semicolons.</code></li>
<li><code>The variable</code>${ARGV}` is unreferenced.</li>
<li>We use functions, not macros or top level code.</li>
<li>Scripts in the scripts tree should not be expected to need changes as part of normal operation. (For example, <code>vcpkg_acquire_msys</code> has hard coded specific packages and versions thereof used which we believe is unacceptable)</li>
<li>All non-splat variable expansions are in quotes "".</li>
<li>There are no "pointer" parameters (where a user passes a variable name rather than the contents) except for out parameters.</li>
<li>Undefined names are not referenced.</li>
<li>Out parameters only set <code>PARENT_SCOPE</code>.</li>
<li><code>CACHE</code> variables are not used.</li>
<li><code>include()</code>s are removed and fixes to <code>port.cmake</code> et al. are made as necessary to avoid this.</li>
<li><code>foreach(RANGE)</code>'s arguments <em>must always be</em> natural numbers, and <code>&lt;start&gt;</code> <em>must always be</em> less than or equal to <code>&lt;stop&gt;</code>.<ul>
<li>This should be checked.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md3629"></a>
Naming Variables</h2>
<ul>
<li><code>cmake_parse_arguments</code>: set prefix to <code>"arg"</code></li>
<li>local variables are named <code>snake_case</code></li>
<li>Internal global variable names are named <code>Z_VCPKG_</code>.</li>
<li>External experimental global variable names are named <code>X_VCPKG_</code>.</li>
<li>Internal functions are named <code>z_vcpkg_*</code><ul>
<li>Functions which are internal to a single function (i.e., helper functions) are named <code>[z_]&lt;func&gt;_&lt;name&gt;</code>, where <code>&lt;func&gt;</code> is the name of the function they are a helper to, and <code>&lt;name&gt;</code> is what the helper function does.<ul>
<li><code>z_</code> should be added to the front if <code>&lt;func&gt;</code> doesn't have a <code>z_</code>, but don't name a helper function <code>z_z_foo_bar</code>.</li>
</ul>
</li>
</ul>
</li>
<li>Public global variables are named <code>VCPKG_</code>.</li>
</ul>
<h1><a class="anchor" id="autotoc_md3630"></a>
Prognosis</h1>
<p>Not everything should remain in the scripts tree. As part of this audit, each helper will be dealt with in one of several ways:</p>
<ul>
<li>Stay in scripts tree</li>
<li>Deleted outright</li>
<li>Moved to a tool port</li>
<li>Deprecated </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
